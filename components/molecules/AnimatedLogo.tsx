/**
 * AnimatedLogo Molecule
 *
 * Animated logo that morphs from "L" to "Logan" on hover.
 * Uses Flubber.js for smooth SVG path morphing.
 * Design System: Terracotta colors, smooth transitions
 */

"use client";

import { motion, useMotionValue, useTransform, animate } from "framer-motion";
import { interpolate } from "flubber";
import { cn } from "@/lib/utils";
import { useState, useEffect, useMemo } from "react";

export interface AnimatedLogoProps {
  /** Height of the logo in pixels */
  height?: number;
  /** Additional wrapper classes */
  className?: string;
  /** External hover state control */
  isHovered?: boolean;
}

// SVG path data for L logo
const L_BACKGROUND = "M945,54c34.58,34.58,54,81.47,54,130.37v568.66c0,13.37-5.58,26.13-15.39,35.22l-213.81,197.97c-8.87,8.22-20.52,12.78-32.61,12.78H184.37c-48.9,0-95.79-19.42-130.37-54h0C19.42,910.42,0,863.53,0,814.63V245.97c0-13.37,5.58-26.13,15.39-35.22L229.2,12.78c8.87-8.22,20.52-12.78,32.61-12.78h552.82c48.9,0,95.79,19.42,130.37,54h0Z";
const L_LETTER = "M628.01,277.2l-8.55,3.15c-3.75,1.5-6.6,3.41-8.55,5.74-1.95,2.33-2.92,5.36-2.92,9.11v216c0,6.3,1.5,10.69,4.5,13.16,3,2.48,7.27,3.71,12.82,3.71h17.33c7.95,0,14.89-1.12,20.81-3.38,5.92-2.25,11.51-6.41,16.76-12.49,5.25-6.08,10.65-14.96,16.2-26.66l15.08-31.5c2.55-5.25,5.77-8.74,9.67-10.46,3.9-1.72,8.33-1.83,13.27-.34,5.1,1.5,8.7,3.98,10.8,7.42,2.1,3.45,2.32,8.1.67,13.95l-22.5,79.42c-2.4,8.25-5.4,14.37-9,18.34-3.6,3.97-9,5.96-16.2,5.96-3.9,0-7.8-.67-11.7-2.02-3.9-1.35-8.29-2.7-13.16-4.05-4.88-1.35-10.76-2.03-17.66-2.03h-164.47c-6.6,0-11.48-1.38-14.62-4.16-3.15-2.77-4.73-6.49-4.73-11.14,0-8.1,3.9-13.65,11.7-16.65l8.55-3.15c3.9-1.5,6.79-3.41,8.66-5.74,1.87-2.32,2.81-5.36,2.81-9.11v-215.1c0-3.75-.94-6.79-2.81-9.11-1.88-2.32-4.76-4.24-8.66-5.74l-8.55-3.15c-7.8-3-11.7-8.55-11.7-16.65,0-4.8,1.58-8.55,4.73-11.25,3.15-2.7,8.02-4.05,14.62-4.05h129.15c6.6,0,11.47,1.35,14.62,4.05,3.15,2.7,4.72,6.45,4.72,11.25,0,8.1-3.9,13.65-11.7,16.65Z";

// SVG path data for Logan logo
const LOGAN_BACKGROUND = "M2083.91,54c34.58,34.58,54,81.47,54,130.37v568.66c0,13.37-5.58,26.13-15.39,35.22l-213.81,197.97c-8.87,8.22-20.52,12.78-32.61,12.78H184.37c-48.9,0-95.79-19.42-130.37-54h0C19.42,910.42,0,863.53,0,814.63V245.97c0-13.37,5.58-26.13,15.39-35.22L229.2,12.78c8.87-8.22,20.52-12.78,32.61-12.78h1691.73c48.9,0,95.79,19.42,130.37,54h0Z";
const LOGAN_LETTERS = "M628.01,277.2l-8.55,3.15c-3.75,1.5-6.6,3.41-8.55,5.74-1.95,2.33-2.92,5.36-2.92,9.11v216c0,6.3,1.5,10.69,4.5,13.16,3,2.48,7.27,3.71,12.82,3.71h17.33c7.95,0,14.89-1.12,20.81-3.38,5.92-2.25,11.51-6.41,16.76-12.49,5.25-6.08,10.65-14.96,16.2-26.66l15.08-31.5c2.55-5.25,5.77-8.74,9.67-10.46,3.9-1.72,8.33-1.84,13.27-.34,5.1,1.5,8.7,3.98,10.8,7.42,2.1,3.45,2.32,8.1.67,13.95l-22.5,79.42c-2.4,8.25-5.4,14.37-9,18.34-3.6,3.97-9,5.96-16.2,5.96-3.9,0-7.8-.67-11.7-2.02-3.9-1.35-8.29-2.7-13.16-4.05-4.88-1.35-10.76-2.03-17.66-2.03h-164.47c-6.6,0-11.48-1.38-14.62-4.16-3.15-2.77-4.73-6.49-4.73-11.14,0-8.1,3.9-13.65,11.7-16.65l8.55-3.15c3.9-1.5,6.79-3.41,8.66-5.74,1.87-2.32,2.81-5.36,2.81-9.11v-215.1c0-3.75-.94-6.79-2.81-9.11-1.88-2.32-4.76-4.24-8.66-5.74l-8.55-3.15c-7.8-3-11.7-8.55-11.7-16.65,0-4.8,1.58-8.55,4.73-11.25s8.02-4.05,14.62-4.05h129.15c6.6,0,11.47,1.35,14.62,4.05,3.15,2.7,4.72,6.45,4.72,11.25,0,8.1-3.9,13.65-11.7,16.65Z M887.21,336.6c25.5,0,47.77,4.84,66.83,14.51,19.05,9.67,33.86,23.21,44.44,40.61,10.58,17.4,15.86,37.65,15.86,60.75,0,21.3-5.55,40.58-16.65,57.83-11.1,17.25-26.44,30.94-46.01,41.06s-42.26,15.19-68.06,15.19-47.78-4.92-66.83-14.74c-19.05-9.82-33.86-23.44-44.44-40.84-10.58-17.4-15.86-37.5-15.86-60.3s5.55-41.21,16.65-58.39c11.1-17.17,26.44-30.75,46.01-40.72,19.58-9.97,42.26-14.96,68.06-14.96ZM903.63,533.92c5.7-1.35,10.05-5.32,13.05-11.92,3-6.6,4.35-16.2,4.05-28.8-.3-12.6-2.55-28.58-6.75-47.92-3.9-18.6-8.29-33.75-13.16-45.45-4.88-11.7-10.16-20.1-15.86-25.2-5.7-5.1-11.63-6.9-17.77-5.4-5.7,1.35-10.05,5.33-13.05,11.93-3,6.6-4.31,16.16-3.94,28.69.37,12.53,2.59,28.54,6.64,48.04,3.9,18.45,8.33,33.56,13.28,45.34,4.95,11.78,10.24,20.18,15.86,25.2,5.62,5.03,11.51,6.86,17.66,5.51Z M1253.95,538.09c15,5.03,25.91,11.85,32.74,20.47,6.82,8.62,10.24,19.54,10.24,32.74,0,23.1-12.9,42.08-38.7,56.92-25.8,14.85-63.45,22.28-112.95,22.28-30.3,0-53.93-1.91-70.88-5.74-16.95-3.83-28.8-9.23-35.55-16.2s-10.12-15.11-10.12-24.41c0-10.5,5.21-19.61,15.64-27.34,10.42-7.73,29.81-13.16,58.16-16.31l1.58,6.97c-1.2,1.35-2.21,3.41-3.04,6.19-.83,2.77-1.24,5.66-1.24,8.66,0,11.85,4.5,21.18,13.5,28.01,9,6.82,25.27,10.24,48.82,10.24,13.65,0,24.15-.79,31.5-2.36,7.35-1.58,12.49-3.94,15.41-7.09s4.39-7.05,4.39-11.7-2.21-8.14-6.64-10.91c-4.43-2.78-11.96-5.17-22.61-7.2-10.65-2.03-25.28-4.16-43.88-6.41-23.1-2.7-40.8-6-53.1-9.9-12.3-3.9-20.78-8.74-25.42-14.51-4.65-5.78-6.97-12.86-6.97-21.26s2.44-16.09,7.31-23.06c4.87-6.97,13.12-12.67,24.75-17.1,11.62-4.42,27.71-6.86,48.26-7.31l2.25,4.5c-2.55.9-4.43,1.91-5.62,3.04-1.2,1.12-1.8,2.36-1.8,3.71s1.09,2.7,3.26,4.05c2.17,1.35,7.76,2.78,16.76,4.28,9,1.5,23.77,3.3,44.33,5.4,24.75,2.55,44.62,6.34,59.62,11.36ZM1262.28,465.52c-10.05,13.5-24.49,24-43.31,31.5-18.83,7.5-41.44,11.25-67.84,11.25-24.9,0-46.01-3.52-63.34-10.58-17.33-7.05-30.45-16.69-39.38-28.91-8.93-12.22-13.39-25.91-13.39-41.06,0-17.85,5.02-33.52,15.08-47.02,10.05-13.5,24.53-24,43.42-31.5,18.9-7.5,41.47-11.25,67.73-11.25s46.2,3.53,63.45,10.58c17.25,7.05,30.34,16.65,39.26,28.8,8.92,12.15,13.39,25.88,13.39,41.17,0,17.85-5.03,33.53-15.08,47.03ZM1133.92,372.82c-2.33,4.8-3.38,11.63-3.15,20.47.22,8.85,1.61,19.95,4.16,33.3,2.7,13.2,5.62,23.96,8.78,32.29,3.15,8.33,6.71,14.21,10.69,17.66,3.97,3.45,8.36,4.73,13.16,3.83,7.35-1.5,11.77-7.27,13.28-17.33,1.5-10.05.3-25.05-3.6-45-3.9-19.95-8.48-34.27-13.72-42.97-5.25-8.7-11.55-12.3-18.9-10.8-4.8.9-8.36,3.75-10.69,8.55ZM1197.25,340.42c8.4-20.7,19.16-36,32.29-45.9,13.12-9.9,27.11-14.85,41.96-14.85,11.55,0,21,3.3,28.35,9.9,7.35,6.6,11.03,16.13,11.03,28.58,0,11.4-2.85,20.59-8.55,27.56-5.7,6.97-13.2,10.46-22.5,10.46-6.45,0-11.36-1.27-14.74-3.83-3.38-2.55-6.23-5.55-8.55-9-2.33-3.45-4.99-6.45-7.99-9-3-2.55-7.28-3.82-12.83-3.82s-10.28,2.18-13.72,6.52c-3.45,4.35-7.58,12.53-12.38,24.53l-20.48-1.35,8.1-19.8Z M1302.78,512.32c0-20.55,9.3-36.79,27.9-48.71,18.6-11.92,44.7-17.89,78.3-17.89,8.85,0,16.57.6,23.17,1.8,6.6,1.2,12,2.92,16.2,5.17l-7.65,19.58c-3.15-1.8-6.11-3.07-8.89-3.83-2.78-.75-5.81-1.12-9.11-1.12-7.35,0-13.16,2.44-17.44,7.31-4.27,4.88-6.41,11.89-6.41,21.04,0,9.6,2.1,16.91,6.3,21.94,4.2,5.03,9.75,7.54,16.65,7.54,4.35,0,8.44-1.01,12.26-3.04,3.83-2.02,6.71-4.39,8.66-7.09l5.4,18c-7.2,10.65-17.66,18.9-31.39,24.75-13.73,5.85-28.39,8.77-43.99,8.77-21,0-37.91-5.17-50.74-15.52-12.83-10.35-19.24-23.25-19.24-38.7ZM1440.25,529.42v-5.17l-7.2-.22v-145.35c0-5.7-1.54-10.27-4.61-13.72-3.08-3.45-7.24-5.17-12.49-5.17-3.9,0-7.31.94-10.24,2.81-2.92,1.88-4.39,4.39-4.39,7.54v24.53c0,12.6-4.31,22.35-12.94,29.25-8.63,6.9-20.96,10.35-37.01,10.35-13.65,0-23.81-2.89-30.49-8.66-6.68-5.77-10.01-13.84-10.01-24.19s4.5-19.8,13.5-29.7c9-9.9,22.54-18.15,40.61-24.75,18.07-6.6,40.84-9.9,68.29-9.9,31.8,0,55.42,5.82,70.88,17.44,15.45,11.63,23.17,27.49,23.17,47.59v107.55c0,2.85.71,5.21,2.14,7.09,1.42,1.88,3.63,2.81,6.64,2.81,2.55,0,4.61-.68,6.19-2.03s3.04-2.7,4.39-4.05c1.05-1.05,2.14-1.95,3.26-2.7,1.12-.75,2.44-1.12,3.94-1.12,2.55,0,4.39.94,5.51,2.81,1.12,1.88,1.69,4.24,1.69,7.09,0,6.6-2.4,13.54-7.2,20.81-4.8,7.28-11.96,13.46-21.49,18.56-9.53,5.1-21.34,7.65-35.44,7.65-16.65,0-30.26-3.53-40.84-10.58-10.58-7.05-15.86-15.9-15.86-26.55Z M1683.47,356.85v156.15c0,6,.45,10.2,1.35,12.6.9,2.4,2.47,4.2,4.72,5.4l4.5,2.47c4.95,2.85,7.43,6.98,7.43,12.38,0,9.6-5.78,14.4-17.33,14.4h-99.67c-6,0-10.35-1.2-13.05-3.6-2.7-2.4-4.05-5.7-4.05-9.9,0-3,.75-5.62,2.25-7.88,1.5-2.25,3.97-4.12,7.42-5.62l4.95-2.25c2.25-1.05,3.83-2.81,4.73-5.29.9-2.48,1.35-6.71,1.35-12.71v-105.75c0-4.8-.64-8.21-1.91-10.24-1.28-2.03-3.19-3.41-5.74-4.16l-4.95-1.57c-3.15-1.05-5.44-2.55-6.86-4.5-1.43-1.95-2.14-4.42-2.14-7.43,0-3.6.97-6.45,2.92-8.55,1.95-2.1,5.62-4.2,11.02-6.3l49.95-19.35c7.65-3,13.84-5.18,18.56-6.53,4.73-1.35,9.34-2.03,13.84-2.03,6.75,0,11.89,1.91,15.41,5.74,3.52,3.82,5.29,8.66,5.29,14.51ZM1675.37,411.75l-13.5-14.4,6.75-6.3c21.15-20.25,39.52-34.39,55.12-42.41,15.6-8.02,29.92-12.04,42.98-12.04,20.1,0,36.3,6.64,48.6,19.91,12.3,13.27,18.45,30.64,18.45,52.09v104.4c0,6,.45,10.24,1.35,12.71.9,2.47,2.48,4.24,4.73,5.29l4.95,2.25c3.45,1.5,5.92,3.38,7.43,5.62,1.5,2.25,2.25,4.88,2.25,7.88,0,4.2-1.35,7.5-4.05,9.9-2.7,2.4-7.05,3.6-13.05,3.6h-99.67c-11.55,0-17.33-4.8-17.33-14.4,0-5.4,2.48-9.52,7.42-12.38l4.5-2.47c2.25-1.2,3.83-3,4.73-5.4.9-2.4,1.35-6.6,1.35-12.6v-90.9c0-9.6-2.21-16.8-6.64-21.6-4.43-4.8-10.61-7.2-18.56-7.2-4.95,0-10.12.98-15.52,2.92-5.4,1.95-10.2,4.8-14.4,8.55l-7.88,6.97Z";

export const AnimatedLogo = ({ height = 40, className, isHovered: externalHovered }: AnimatedLogoProps) => {
  const [internalHovered, setInternalHovered] = useState(false);
  const progress = useMotionValue(0);

  // Use external hover if provided, otherwise use internal
  const isHovered = externalHovered !== undefined ? externalHovered : internalHovered;

  // Pre-calculate interpolator for background shape only
  const backgroundInterpolator = useMemo(
    () => interpolate(L_BACKGROUND, LOGAN_BACKGROUND, { maxSegmentLength: 1 }),
    []
  );

  // Use the pre-calculated interpolator
  const backgroundPath = useTransform(progress, (v) => backgroundInterpolator(v));

  // Animate viewBox to change aspect ratio
  const viewBoxWidth = useTransform(progress, [0, 1], [999, 2137.9]);

  // Animate white rectangle width
  const rectWidth = useTransform(progress, [0, 1], [603, 1746]);

  // Crossfade between L and Logan letters with opacity - tighter timing to avoid flicker
  const lOpacity = useTransform(progress, [0, 0.3], [1, 0]);
  const loganOpacity = useTransform(progress, [0.3, 0.6], [0, 1]);

  useEffect(() => {
    const animation = animate(progress, isHovered ? 1 : 0, {
      duration: 0.4,
      ease: [0.33, 1, 0.68, 1],
    });

    return () => animation.stop();
  }, [isHovered, progress]);

  return (
    <motion.div
      className={cn("relative cursor-pointer", className)}
      onHoverStart={externalHovered === undefined ? () => setInternalHovered(true) : undefined}
      onHoverEnd={externalHovered === undefined ? () => setInternalHovered(false) : undefined}
      onTapStart={externalHovered === undefined ? () => setInternalHovered(true) : undefined}
      style={{ height }}
      aria-label="Logan Bell"
      role="img"
    >
      <motion.svg
        style={{
          height: "100%",
          width: "auto",
        }}
        viewBox={useTransform(viewBoxWidth, (w) => `0 0 ${w} 999`)}
        preserveAspectRatio="xMinYMid meet"
        xmlns="http://www.w3.org/2000/svg"
      >
        <defs>
          <style>
            {`
              .cls-1 { fill: none; }
              .cls-2 { fill: #fff; }
              .cls-3 { fill: #c95d3c; }
            `}
          </style>
        </defs>

        {/* Morphing background shape */}
        <motion.path className="cls-3" d={backgroundPath} />

        {/* Morphing white rectangle */}
        <motion.rect
          className="cls-2"
          x="288"
          y="108"
          width={rectWidth}
          height="603"
          rx="32"
          ry="32"
        />

        {/* L letter - fades out */}
        <motion.path
          className="cls-3"
          d={L_LETTER}
          style={{ opacity: lOpacity }}
        />

        {/* Logan letters - fades in */}
        <motion.path
          className="cls-3"
          d={LOGAN_LETTERS}
          style={{ opacity: loganOpacity }}
        />
      </motion.svg>
    </motion.div>
  );
};

AnimatedLogo.displayName = "AnimatedLogo";
